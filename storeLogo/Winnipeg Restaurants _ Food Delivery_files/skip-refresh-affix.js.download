window.skipthedishes.Affix=function($){function _calculateOffset(offset){return"function"==typeof offset?offset():offset}function _getScrollbarWidth(){var $measure=$('<div class="modal-scrollbar-measure"></div>').appendTo("body"),scrollbarWidth=$measure[0].offsetWidth-$measure[0].clientWidth;return $measure.remove(),scrollbarWidth}var _scrollbarWidth=0,_documentScrollTop=0,_documentHeight=0,_windowHeight=0,_windowWidth=0,_scrollFromBottom=0,MD_SCREEN_WIDTH=992;return{init:function(params){function triggerAffixEvents(){$element.hasClass("affix")?$element.trigger("affix.bs.affix").trigger("affixed.bs.affix"):$element.hasClass("affix-top")?$element.trigger("affix-top.bs.affix").trigger("affixed-top.bs.affix"):$element.hasClass("affix-bottom")&&$element.trigger("affix-bottom.bs.affix").trigger("affixed-bottom.bs.affix")}function updateWidth(){if(params.updateWidth){var $clone=$element.clone().removeClass("affix affix-bottom").css({visibility:"hidden",width:"auto"}).insertAfter($element);naturalWidth=$clone.outerWidth(),$clone.remove(),$element.css("width",naturalWidth)}}function updateScrollbarMargin(){params.updateScrollbarMargin&&$element.css("padding-right",$element.height()>maxHeight&&$element[0].scrollHeight>maxHeight?_scrollbarWidth:"")}function updateMaxHeight(){if(params.updateMaxHeight)if($element.is(".affix-bottom"))if(_scrollFromBottom<bottomOffsets.affixTriggerOffset){var scrollAreaHeight=_windowHeight-bottomOffsets.elementPositionOffset-bottomOffsets.affixTriggerOffset;maxHeight=scrollAreaHeight+_scrollFromBottom,$element.find(elementInnerSelector).addBack().css({"max-height":maxHeight})}else $element.removeClass("affix-bottom").addClass("affix").trigger("affix.bs.affix").trigger("affixed.bs.affix");else $element.is(".affix")&&(maxHeight=_windowWidth<MD_SCREEN_WIDTH?_windowHeight:_windowHeight-topOffsets.elementPositionOffset,$element.find(elementInnerSelector).addBack().css({"max-height":maxHeight}))}function handleScrollWhenAffixedToBottom(){params.updateMaxHeight&&(_documentHeight=$(document).height(),_windowHeight=window.innerHeight,_windowWidth=window.innerWidth,_documentScrollTop=$(document).scrollTop(),_scrollFromBottom=_documentHeight-_documentScrollTop-_windowHeight,updateMaxHeight()),"function"==typeof params.scrollWhenAffixedToBottomCallback&&params.scrollWhenAffixedToBottomCallback()}function updateOffsets(){$visibleMobile[0]&&$visibleMobile.is(":visible")?(offsets.top.hasOwnProperty("mobileAffixTriggerOffset")&&(topOffsets.affixTriggerOffset=_calculateOffset(offsets.top.mobileAffixTriggerOffset)),offsets.bottom&&offsets.bottom.hasOwnProperty("affixTriggerOffset")&&offsets.bottom.hasOwnProperty("mobileAffixTriggerOffset")&&(bottomOffsets.affixTriggerOffset=_calculateOffset(offsets.bottom.mobileAffixTriggerOffset))):(topOffsets.affixTriggerOffset=_calculateOffset(offsets.top.affixTriggerOffset||0),offsets.bottom&&offsets.bottom.hasOwnProperty("affixTriggerOffset")&&(bottomOffsets.affixTriggerOffset=_calculateOffset(offsets.bottom.affixTriggerOffset))),topOffsets.elementPositionOffset=_calculateOffset(offsets.top.elementPositionOffset||0),offsets.bottom&&offsets.bottom.hasOwnProperty("affixTriggerOffset")&&(bottomOffsets.elementPositionOffset=_calculateOffset(offsets.bottom.elementPositionOffset||0)),triggerAffixEvents()}var naturalWidth,$element,maxHeight,$visibleMobile,offset={},offsets=params.offsets||{},topOffsets={},bottomOffsets={},elementInnerSelector=params.elementSelectors.elementInner||null,topMessageContainerSelector=params.elementSelectors.topMessageContainer,alertSelector=params.elementSelectors.alert;$(document).ready(function(){$element=$(params.elementSelectors.element),$visibleMobile=$(params.elementSelectors.visibleMobile),_documentHeight=$(document).height(),_windowHeight=window.innerHeight,_windowWidth=window.innerWidth,_scrollbarWidth||0===_scrollbarWidth||(_scrollbarWidth=_getScrollbarWidth()),updateOffsets(),updateWidth(),updateScrollbarMargin(),$(topMessageContainerSelector).find(alertSelector).on("closed.bs.alert",function(){updateOffsets(),$element.affix("checkPosition")}),offset.top=function(){return this.top=offsets.top.affixTriggerOffset||0},offsets.bottom&&offsets.bottom.hasOwnProperty("affixTriggerOffset")&&(offset.bottom=function(){return this.bottom=offsets.bottom.affixTriggerOffset}),$element.affix({offset:offset}).on("affix.bs.affix",function(){$(document).off("scroll",handleScrollWhenAffixedToBottom),$element.css({top:topOffsets.elementPositionOffset,width:naturalWidth,bottom:"auto"}),updateScrollbarMargin(),"function"==typeof params.affixCallback&&params.affixCallback()}).on("affixed.bs.affix",function(){updateMaxHeight()}).on("affix-top.bs.affix",function(){updateScrollbarMargin(),"function"==typeof params.affixTopCallback&&params.affixTopCallback()}).on("affix-bottom.bs.affix",function(e){e.preventDefault(),updateScrollbarMargin(),$element.removeClass("affix").addClass("affix-bottom").css({bottom:0,top:"auto"}).trigger("affixed-bottom.bs.affix")}).on("affixed-bottom.bs.affix",function(){handleScrollWhenAffixedToBottom(),$(document).on("scroll",handleScrollWhenAffixedToBottom)}),triggerAffixEvents(),$element.affix("checkPosition"),$(window).resize(function(){var newWindowWidth=window.innerWidth;_documentHeight=$(document).height(),_windowHeight=window.innerHeight,newWindowWidth!==_windowWidth&&(_windowWidth=newWindowWidth,updateOffsets(),$element.affix("checkPosition"),updateMaxHeight(),updateWidth(),updateScrollbarMargin())}),$(document).on("skip:alert:added",function(){updateOffsets(),$element.affix("checkPosition"),$(topMessageContainerSelector).find(alertSelector).on("closed.bs.alert",function(){updateOffsets(),$element.affix("checkPosition")})})})}}}(jQuery);