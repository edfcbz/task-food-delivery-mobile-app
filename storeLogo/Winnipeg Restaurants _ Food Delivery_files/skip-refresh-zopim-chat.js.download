window.skipthedishes=window.skipthedishes||{},window.skipthedishes.ZopimChat=function($){function loadScript(params){if(!window.$zopim){var d=document,s="script",z=$zopim=function(c){z._.push(c)},$=z.s=d.createElement(s),e=d.getElementsByTagName(s)[0];z.set=function(o){z.set._.push(o)},z._=[],z.set._=[],$.async=!0,$.setAttribute("charset","utf-8"),$.src="https://v2.zopim.com/?"+params.zopimKey,z.t=+new Date,$.type="text/javascript",e.parentNode.insertBefore($,e)}}function _runWhenZopimAvailable(callbackFunction){_callZopimFailMaxCount>=_callZopimFailCount?window.$zopim&&window.$zopim.livechat?callbackFunction():(_callZopimFailCount++,setTimeout(function(){_runWhenZopimAvailable(callbackFunction)},500)):$(_zopimLinkSelector).attr("href","https://v2.zopim.com/widget/livechat.html?key="+_zopimKey+"&lang=en").attr("target","_blank")}function _getInitialMessage(params){return params.initialUserChatInfo.split(",").reduce(function(message,key){return params[key]&&(message+="orderNumber"==key?"Order Number: "+params[key]:params[key]+"\n"),message},"")}var _zopimKey,_zopimLinkSelector,_widgetVerticalOffset=0,_widgetHorizontalOffset=15,_callZopimFailCount=0,_callZopimFailMaxCount=8;return{init:function(params){_zopimKey=params.zopimKey,_zopimLinkSelector=params.zopimLinkSelector,$(document).ready(function(){loadScript(params),_runWhenZopimAvailable(function(){$zopim(function(){if($zopim.livechat.hideAll(),$zopim.livechat.window.setSize("large"),$zopim.livechat.window.setOffsetVertical(_widgetVerticalOffset),$zopim.livechat.window.setOffsetHorizontal(_widgetHorizontalOffset),params.userPhoneNumber&&$zopim.livechat.setPhone(params.userPhoneNumber),params.userName&&$zopim.livechat.setName(params.userName),params.userEmail&&$zopim.livechat.setEmail(params.userEmail),params.isOrderTrackerPage&&params.initialUserChatInfo&&params.orderNumber){var initialMassage=_getInitialMessage(params);initialMassage&&$zopim.livechat.setOnChatStart(function(){$zopim.livechat.say(initialMassage)})}$zopim.livechat.addTags(params.tags.split(",")),$zopim.livechat.departments.setVisitorDepartment(params.visitorDepartment),$zopim.livechat.departments.filter("")}),$(document).on("click",_zopimLinkSelector,function(){var autoChatContent=$(this).data("auto-chat-content");$zopim(function(){params.orderNumber&&autoChatContent&&(params.isReviewPage||params.isPostReviewOrderDetailsPage)&&($zopim.livechat.say("Order Number: "+params.orderNumber),$zopim.livechat.say(window.skipthedishes.CommonTools.unescapeHtml(autoChatContent))),params.isOrderTrackerPage||params.isReviewPage||params.isPostReviewOrderDetailsPage?($zopim.livechat.window.show(),$zopim.livechat.window.onHide(function(){$zopim.livechat.hideAll()})):$zopim.livechat.window.openPopout()})})})})}}}(jQuery);