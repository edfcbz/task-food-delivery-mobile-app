window.skipthedishes=window.skipthedishes||{},window.skipthedishes.RestaurantInputFilter=function($,commonTools){function _publish(callback,eventHandler,publishEventName,value){callback(value),sessionStorage.setItem(SESSION_STORAGE_KEY,value),eventHandler&&publishEventName&&eventHandler(publishEventName).publish(value)}function _updateSuggestions($dropdown,cuisines,defaultSuggestions,userInput){var suggestions=[],suggestionsHTML="";userInput.length?cuisines.forEach(function(cuisine){cuisine.toLowerCase().indexOf(userInput.toLowerCase())>-1&&suggestions.length<MAX_NUMBER_OF_SUGGESTIONS&&suggestions.push(cuisine)}):(defaultSuggestions.forEach(function(cuisine){suggestions.push(cuisine)}),suggestionsHTML='<li class="dropdown-header"><a href="javascript:void(0);">Suggested Searches:</a></li>\n'),suggestions.forEach(function(suggestion){suggestionsHTML+='<li><a href="javascript:void(0);">'+suggestion+"</a></li>\n"}),suggestions.length>0?$dropdown.parent().addClass("open"):$dropdown.parent().removeClass("open"),$dropdown.html(suggestionsHTML)}var _timer,_hideSuggestionsTimer,MAX_NUMBER_OF_SUGGESTIONS=4,SESSION_STORAGE_KEY="savedFilterValue";return{init:function(params){$(document).ready(function(){function setValue(selectedValue){$input.val(selectedValue)}var $navbarSearchDropdown=$(params.searchDropdownSelector),$input=$(params.inputSelector),$parentForm=$input.closest("form"),$showSearchButtonMobile=$(params.showSearchButtonMobileSelector);params.eventHandler&&params.subscribeEventName&&params.eventHandler(params.subscribeEventName).subscribe(setValue),$parentForm.on("submit",function(e){return e.preventDefault(),e.stopPropagation(),!1}),$input.on(params.eventType,function(e){var value=$input.val().trim();"keyup"===params.eventType?(clearTimeout(_timer),_timer=setTimeout(function(){_updateSuggestions($navbarSearchDropdown,params.cuisines,params.defaultSuggestions,value),_publish(params.callback,params.eventHandler,params.publishEventName,value)},500)):(_updateSuggestions($navbarSearchDropdown,params.cuisines,params.defaultSuggestions,value),_publish(params.callback,params.eventHandler,params.publishEventName,value))}),$input.focus(function(){clearTimeout(_hideSuggestionsTimer),_updateSuggestions($navbarSearchDropdown,params.cuisines,params.defaultSuggestions,$input.val().trim())}),$input.blur(function(){_hideSuggestionsTimer=setTimeout(function(){$navbarSearchDropdown.parent().removeClass("open")},500)});var savedFilterValue=commonTools.unescapeHtml(params.defaultSearch)||sessionStorage.getItem(SESSION_STORAGE_KEY);savedFilterValue&&($input.val(savedFilterValue),setTimeout(function(){$showSearchButtonMobile.click()},100),_publish(params.callback,params.eventHandler,params.publishEventName,savedFilterValue.trim())),$(document).on("click",params.searchDropdownSelector+" li:not("+params.searchDropdownHeaderSelector+")",function(){$input.val($(this).text()),_publish(params.callback,params.eventHandler,params.publishEventName,$input.val().trim())}),$showSearchButtonMobile.click(function(){$(params.searchContainerSelector).removeClass("hidden-xs hidden-sm"),$(params.mobileFilterBarSelector).addClass("hidden-xs hidden-sm"),parseInt($input.width())<210&&$input.attr("placeholder",$input.attr("placeholder").substr(0,$input.attr("placeholder").length-4)+"...")}),$(params.clearSearchMobileSelector).click(function(){$input.val("").focus(),_publish(params.callback,params.eventHandler,params.publishEventName,"")}),$(params.cancelSearchMobileSelector).click(function(){$input.val("").blur(),_publish(params.callback,params.eventHandler,params.publishEventName,""),$(params.searchContainerSelector).addClass("hidden-xs hidden-sm"),$(params.mobileFilterBarSelector).removeClass("hidden-xs hidden-sm")})})}}}(jQuery,window.skipthedishes.CommonTools);