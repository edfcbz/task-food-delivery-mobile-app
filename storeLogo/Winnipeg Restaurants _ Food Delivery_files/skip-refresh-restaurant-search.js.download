window.skipthedishes=window.skipthedishes||{},window.skipthedishes.RestaurantSearch=function($,skipLoading,skipLazyLoad){function _groupByRestaurantsTop(restaurantItems){if(_openRestaurantsTop){var groupedRestaurantItems=_getInitialGroupsForTopFilter();return $.each(restaurantItems,function(idx,restaurantItem){var group=_getGroupForTopFilter($(restaurantItem));groupedRestaurantItems[group].push(restaurantItem)}),[].concat.apply([],groupedRestaurantItems)}return restaurantItems}function _getGroupForTopFilter($restaurant){var open=$restaurant.data("restaurant-open"),preOrder=$restaurant.data("restaurant-pre-order"),online=$restaurant.data("restaurant-online");return open&&preOrder&&online||open&&!preOrder&&online?0:!open&&preOrder&&online?1:!open||preOrder||online?open||preOrder||online?4:3:2}function _getInitialGroupsForTopFilter(){var groupedRestaurantItems=[];return groupedRestaurantItems[0]=[],groupedRestaurantItems[1]=[],groupedRestaurantItems[2]=[],groupedRestaurantItems[3]=[],groupedRestaurantItems[4]=[],groupedRestaurantItems}function _updateRestaurantList(){skipLoading.showLoading(!0);var nameAttributeSelector="",cuisineAttributeSelector="";$(_restaurantSelector).addClass("hidden"),_$restaurantSearchError.addClass("hidden"),""!=_searchString?(nameAttributeSelector+='[data-restaurant-name-searchable*="'+_searchString+'"]',cuisineAttributeSelector+='[data-restaurant-cuisines-searchable*="'+_searchString+'"]'):(nameAttributeSelector+='[data-restaurant-name-searchable!=""]',cuisineAttributeSelector+='[data-restaurant-cuisines-searchable!=""]');var $restaurants=$(_restaurantSelector+nameAttributeSelector+", "+_restaurantSelector+cuisineAttributeSelector),$restaurantListContainer=$(_$restaurantListContainer),restaurantItems=$restaurants.get();restaurantItems.sort(function(a,b){var $a=$(a),$b=$(b);return _sortFilter==FEE?$b.data("restaurant-fee-after-minimum")===$a.data("restaurant-fee-after-minimum")?$b.data("restaurant-fee-minimum")===$a.data("restaurant-fee-minimum")?$b.data("restaurant-fee")===$a.data("restaurant-fee")?$b.data("restaurant-default-sort")===$a.data("restaurant-default-sort")?$b.data("restaurant-distance")===$a.data("restaurant-distance")?$b.data("restaurant-name-searchable")<$a.data("restaurant-name-searchable")?1:-1:$b.data("restaurant-distance")<$a.data("restaurant-distance")?1:-1:$b.data("restaurant-default-sort")<$a.data("restaurant-default-sort")?1:-1:$b.data("restaurant-fee")<$a.data("restaurant-fee")?1:-1:$b.data("restaurant-fee-minimum")<$a.data("restaurant-fee-minimum")?1:-1:$b.data("restaurant-fee-after-minimum")<$a.data("restaurant-fee-after-minimum")?1:-1:_sortFilter==TIME?$b.data("restaurant-min-estimated-time")==$a.data("restaurant-min-estimated-time")?$b.data("restaurant-distance")<$a.data("restaurant-distance")?1:-1:$b.data("restaurant-min-estimated-time")<$a.data("restaurant-min-estimated-time")?1:-1:_sortFilter==SKIPSCORE?$b.data("restaurant-skip-score")==$a.data("restaurant-skip-score")?$b.data("restaurant-distance")<$a.data("restaurant-distance")?1:-1:$b.data("restaurant-skip-score")>$a.data("restaurant-skip-score")?1:-1:_sortFilter==DISTANCE?$b.data("restaurant-distance")<$a.data("restaurant-distance")?1:-1:_sortFilter==DEFAULT?$b.data("restaurant-default-sort")===$a.data("restaurant-default-sort")?$b.data("restaurant-distance")===$a.data("restaurant-distance")?$b.data("restaurant-name-searchable")<$a.data("restaurant-name-searchable")?1:-1:$b.data("restaurant-distance")<$a.data("restaurant-distance")?1:-1:$b.data("restaurant-default-sort")<$a.data("restaurant-default-sort")?1:-1:void 0}),restaurantItems=_groupByRestaurantsTop(restaurantItems),$.each(restaurantItems,function(idx,itm){$restaurantListContainer.append(itm)}),$restaurants.removeClass("hidden"),0==$restaurants.size()?_$restaurantSearchError.removeClass("hidden"):skipLazyLoad.reLazyLoad();var $filteredClosedRestaurants=$(_firstClosedRestaurantSelector);$("."+_previousFirstClosedRestaurantClass).removeClass(_previousFirstClosedRestaurantClass),$filteredClosedRestaurants.length>0?(_$closedRestaurantDivider.removeClass("hidden"),$filteredClosedRestaurants.addClass(_previousFirstClosedRestaurantClass),$filteredClosedRestaurants.before(_$closedRestaurantDivider)):_$closedRestaurantDivider.addClass("hidden"),skipLoading.showLoading(!1)}var _restaurantSelector,_$restaurantSearchError,_sortFilter,_$restaurantListContainer,_$closedRestaurantDivider,_firstClosedRestaurantSelector,_previousFirstClosedRestaurantClass,FEE="FEE",TIME="TIME",SKIPSCORE="SKIPSCORE",DISTANCE="DISTANCE",DEFAULT="DEFAULT",_searchString="",_openRestaurantsTop=!0;return{init:function(params){$(document).ready(function(){_restaurantSelector=params.restaurantSelector,_sortFilter=params.initialSortFilter,_firstClosedRestaurantSelector=params.firstClosedRestaurantSelector,_$restaurantListContainer=$(params.restaurantListContainerSelector),_$restaurantSearchError=$(params.restaurantSearchErrorSelector),_$closedRestaurantDivider=$(params.closedRestaurantDividerSelector),_previousFirstClosedRestaurantClass=params.previousFirstClosedRestaurantClass,$(params.mobileSearchButtonSelector).click(function(){setTimeout(function(){$(params.mobileSearchInputSelector).focus()},100)})})},filterByNameAndCuisine:function(value){_searchString=value.toLowerCase(),_searchString=_searchString.replace(/([^\s\w]|_)+/g,"")},sortFilter:function(value){_sortFilter=value},updateRestaurantList:function(){_updateRestaurantList()}}}(jQuery,window.skipthedishes.Loading,window.skipthedishes.LazyLoad);