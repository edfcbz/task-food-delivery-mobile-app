window.skipthedishes.RestaurantSort=function($,skipAnalytics){function _setValue(value){var $selection=_$filterInput.find(MENU_SELECTOR.replace("--value--",value));return $selection.hasClass(_menuItemClasses.disabled)&&($selection=_$filterInput.find(MENU_SELECTOR.replace("--value--",_defaultSortValue))),_$filterInput.find("a").removeClass(_menuItemClasses.active).addClass(_menuItemClasses.regular),$selection.addClass(_menuItemClasses.active).removeClass(_menuItemClasses.regular),_$filterInput.find("li").removeClass("disabled"),$selection.parents("li").addClass("disabled"),_$sortCaption.text($selection.data("caption")),$selection.data("value")==DEFAULT?(_$sortCaption.addClass("hidden-xs hidden-sm"),_$sortClear.addClass("hidden")):(_$sortCaption.removeClass("hidden-xs hidden-sm"),_$sortClear.removeClass("hidden")),$selection.data("value")==value}var _$filterInput,_defaultSortValue,_menuItemClasses,_$sortCaption,_$sortClear,SESSION_STORAGE_KEY="savedSortValue",MENU_SELECTOR="a[data-value='--value--']",DEFAULT="DEFAULT";return{init:function(params){var callback=params.callback,eventHandler=params.eventHandler,subscribeEventName=params.subscribeEventName,publishEventName=params.publishEventName;_menuItemClasses={active:params.activeMenuItemClass,regular:params.regularMenuItemClass,disabled:params.disabledMenuItemClass},_defaultSortValue=params.defaultSortValue,$(document).ready(function(){_$filterInput=$(params.filterInputSelector),_$sortCaption=$(params.sortCaptionSelector),_$sortClear=$(params.sortClearSelector);var savedSortValue=sessionStorage.getItem(SESSION_STORAGE_KEY)||_defaultSortValue,isSortAvailable=_setValue(savedSortValue);callback&&isSortAvailable&&savedSortValue!=_defaultSortValue&&callback(savedSortValue),eventHandler&&subscribeEventName&&eventHandler(subscribeEventName).subscribe(_setValue),_$filterInput.on("click","a",function(){if(!$(this).hasClass(_menuItemClasses.disabled)){var value=$(this).data("value"),$filterChoice=_$filterInput.find("."+_menuItemClasses.active);value!==$filterChoice.data("value")&&($(params.sortMenuSelector).slideUp("fast"),callback&&(callback(value),sessionStorage.setItem(SESSION_STORAGE_KEY,value)),eventHandler&&publishEventName&&eventHandler(publishEventName).publish(value),skipAnalytics.sendAnalytics($(this).data("analytics-label"),"click",$(this).data("analytics-value")))}}),_$sortClear.on("click",function(){callback&&(callback(DEFAULT),sessionStorage.setItem(SESSION_STORAGE_KEY,DEFAULT)),eventHandler&&publishEventName&&eventHandler(publishEventName).publish(DEFAULT),skipAnalytics.sendAnalytics("Sort","click","Clear Sort")}),$(params.sortSelectorAreaSelector).click(function(e){e.preventDefault(),$(params.sortMenuSelector).slideToggle("fast")})}),$(document).on("click",function(event){$(event.target).is(params.sortSelectorAreaSelector)||$(event.target).hasClass(_menuItemClasses.active)||$(params.sortMenuSelector).slideUp("fast")})}}}(jQuery,window.skipthedishes.Analytics);